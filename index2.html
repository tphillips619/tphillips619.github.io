<!DOCTYPE html>
<html lang= "en">
  <head>
    <title>Price History</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<!--  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  -->
<!-- <script src="http://d3js.org/d3.v3.min.js"></script> -->
<!-- <script src="http://code.jquery.com/jquery.js"></script> -->
<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script> -->

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="d3/d3.v3.min.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <style> 

path {
    stroke-width: 3;
    fill: none;
}

.axis path,
.axis line {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    shape-rendering: crispEdges;
}

.grid .tick {
    stroke: lightgrey;
    stroke-opacity: 0.3;
    shape-rendering: crispEdges;
}
.grid path {
    stroke-width: 0;
}

.legend {
    font-size: 14px;
    font-weight: bold;
    text-anchor: left;
}

div.tooltip {
    position: absolute;
    text-align: center;
    width: 110px;
    height: 28px;
    padding: 2px;
    font: 12px sans-serif; 
    background: lightsteelblue;
    border: 0px;
    border-radius: 8px;
    pointer-events: none;
}

    </style>
   <body>
       <nav class="navbar navbar-inverse">
           <div class="container-fluid">
               <div class="navbar-header">      
                   <a class="navbar-brand" href="#">Home Price Viz</a>    
               </div>    
               <ul class="nav navbar-nav">      
                   <li><a href="index.html">Home</a></li>      
                   <li class="active"><a href="index2.html">Price History</a></li>      
                   <li><a href="index3.html">Choropleth</a></li>      
                   <li><a href="index4.html">Interest Rate</a></li>    
               </ul>  
           </div>
       </nav>
       <div id="viz" class="container">
       </div>
       <div class="container">
          <h2>Price History</h2>
          <p>  The price history chart below displays the Zillow Home Value Index (ZHVI) price history for two bedroom units located in Zip Code 92610 and for the Orange County area. The <a href="http://files.zillowstatic.com/research/public/Zip/Zip_Zhvi_2bedroom.csv">data</a> provides median home prices over a 20 year period and allows the viewer to glean insights from the overall trend of home prices.  Price histories for Orange County and 92610 appear to have a similar shape for median house price, although the price histories for the county area look noticeable "smoother" as the data is averaged for more data points. According to Zillow's dataset for two bedroom units, median home prices in both areas have not climbed past their pre-recession peak in 2006. </p> 
          <p>The legend allows the viewer to select and unselect a price history.  Mouseover the priceline to see the exact values. </p>
       </div>
       <div>
           <ul class="pager">
               <li class="previous"><a href="index.html">Previous</a></li>
               <li class="next"><a href="index3.html">Next</a></li>
           </ul>
       </div>
      
      <script>
var margin = {top: 40, right: 120, bottom: 70, left: 80},
    width = 800 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var parseDate = d3.time.format("%Y-%m").parse;
var formatTime = d3.time.format("%B %Y");

var x = d3.time.scale().range([0, width]);
var y = d3.scale.linear().range([height, 0]);

var xAxis = d3.svg.axis().scale(x)
    .orient("bottom").ticks(10);

var yAxis = d3.svg.axis().scale(y)
    .orient("left").ticks(10);


// Define the line
var priceline = d3.svg.line()
    .defined(function(d) { return d.price != 0; })        // Omits missing value instead of drawing it with value of 0 
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.price); });

// Functions to add grid lines
function make_x_axis() {
     return d3.svg.axis()
	.scale(x)
	.orient("bottom")
	.ticks(20)
}
function make_y_axis() {
    return d3.svg.axis()
	.scale(y)
	.orient("left")
	.ticks(10)
}
  
// Adds the svg canvas
var svg = d3.select("#viz")
    .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("id", "lineChartCanvas")
    .append("g")
        .attr("transform", 
              "translate(" + margin.left + "," + margin.top + ")"); 

// Get the data
d3.csv("data/data2.csv", function(error, data) {
    data.forEach(function(d) {
        d.date = parseDate(d.date);
        d.price = +d.price
        d.area= d.area;
    });

    // Scale the range of the data
    x.domain(d3.extent(data, function(d) { return d.date; }));
    y.domain([0, d3.max(data, function(d) { return d.price;})]);  


    var dataNest = d3.nest()
        .key(function(d) { return d.area;})
        .entries(data);

    var div = d3.select("#viz").append("div")
       	.attr("class", "tooltip")
       	.style("opacity", 0);

    var color = d3.scale.category10();

    dataNest.forEach(function(d,i){
//        console.log("d.key: " + d.key);
        svg.append("path")
            .attr("class","line")
            .style("stroke", function() {
                return d.color = color(d.key); })
            .attr("id", 'tag'+d.key.replace(/\s+/g, ''))
            .attr("d",priceline(d.values));

        // Add the Legend
        svg.append("text")
            .attr("x",width) 
//            .attr("y", (height/3) + i*20)
            .attr("y", margin.top + i*20)
            .attr("class", "legend")
            .style("fill", function() { 
                return d.color = color(d.key); })
            .on("click", function(){
                // Determine if current line is visible
                var active = d.active ? false : true,
                newOpacity = active ? 0 : 1;
                // Hide or show the elements based on the ID
                d3.select("#tag"+d.key.replace(/\s+/g, '')) 
                    .transition().duration(100)
                    .style("opacity", newOpacity);
                d.active = active;
            })
            .text(d.key);

    	// Add the scatterplot (needed to sense mouseovers for tooltip)
    	svg.selectAll("dot")
            .data(data)
        .enter().append("circle")
           	.style("opacity", 0)                                                    
	        .attr("r", 7)   //Can adjust how close to the line the mouse be in order to show tooltip    
        	.attr("cx", function(d) { return x(d.date); })           
	        .attr("cy", function(d) { return y(d.price); })         
        	.on("mouseover", function(d) {          
	            div.transition()            
	                .duration(200)          
	                .style("opacity", .9);          
	            div.html(formatTime(d.date) + "<br/>"  + d3.format("$,")(d.price))
        	        .style("left", (d3.event.pageX) + "px")         
	                .style("top", (d3.event.pageY - 28) + "px");    
        	    })                                  
	        .on("mouseout", function(d) {           
	            div.transition()            
	                .duration(500)          
	                .style("opacity", 0);   
	        });
    });

    // Add the X Axis
    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

    // Label X Axis 
    svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - (margin.left))
        .attr("x",0 - (height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Median Price for 2 Bed Units");

    // Add the Y Axis
    svg.append("g")
        .attr("class", "y axis")
        .call(yAxis);

    // Add grid lines
    svg.append("g")
        .attr("class", "grid")
        .attr("transform", "translate(0," + height + ")")
        .call(make_x_axis()
                .tickSize(-height, 0, 0)
                .tickFormat("")
         );
    svg.append("g")
        .attr("class", "grid")
        .call(make_y_axis()
                .tickSize(-width, 0, 0)
                .tickFormat("")
        );

    // Add the chart title
    svg.append("text")
        .attr("x", (width / 2))
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")
        .style("font-size", "22px")
        .text("ZHVI Price History");

});
</script>
</body>
</html>
